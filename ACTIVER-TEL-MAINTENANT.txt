═══════════════════════════════════════════════════════════════════
  📱 ACTIVER LE TÉLÉPHONE DU COMPTE SUPER ADMIN
═══════════════════════════════════════════════════════════════════

✅ COMPTE CRÉÉ !
   - ID: 84401dfc-f23e-46e7-b201-868f2140ab73
   - Email: 33661002616@ndjobi.com
   - Profil: ✅ Créé
   - Rôle: ✅ super_admin attribué

❌ PROBLÈME RESTANT :
   - Téléphone: "Not active" dans auth.users
   - Le système ne peut pas trouver le compte par téléphone

🔧 SOLUTION :
   Activer le téléphone dans auth.users

═══════════════════════════════════════════════════════════════════
  📋 EXÉCUTER CE SCRIPT SQL MAINTENANT
═══════════════════════════════════════════════════════════════════

1. Ouvrez Supabase SQL Editor :
   👉 https://supabase.com/dashboard/project/xfxqwlbqysiezqdpeqpv/sql/new

2. Copiez-collez ce script :

──────────────────────────────────────────────────────────────────

-- ACTIVER LE TÉLÉPHONE DU SUPER ADMIN

UPDATE auth.users
SET 
    phone = '+33661002616',
    phone_confirmed_at = NOW(),
    raw_app_meta_data = jsonb_set(
        COALESCE(raw_app_meta_data, '{}'::jsonb),
        '{providers}',
        '["email", "phone"]'::jsonb
    ),
    raw_user_meta_data = jsonb_set(
        COALESCE(raw_user_meta_data, '{}'::jsonb),
        '{phone}',
        '"+33661002616"'::jsonb
    ),
    updated_at = NOW()
WHERE id = '84401dfc-f23e-46e7-b201-868f2140ab73';

-- Vérifier le profil
INSERT INTO public.profiles (
    id, email, full_name, phone, organization, created_at, updated_at
)
VALUES (
    '84401dfc-f23e-46e7-b201-868f2140ab73',
    '33661002616@ndjobi.com',
    'Super Administrateur',
    '+33661002616',
    'Administration Système',
    NOW(), NOW()
)
ON CONFLICT (id) DO UPDATE SET
    phone = EXCLUDED.phone,
    updated_at = NOW();

-- Vérifier le rôle
INSERT INTO public.user_roles (user_id, role, created_at)
VALUES ('84401dfc-f23e-46e7-b201-868f2140ab73', 'super_admin', NOW())
ON CONFLICT (user_id) DO UPDATE SET role = EXCLUDED.role;

-- VÉRIFICATION FINALE
SELECT 
    '✅ CONFIGURATION COMPLÈTE' as status,
    u.email,
    u.phone as "téléphone",
    u.phone_confirmed_at as "téléphone_confirmé",
    p.full_name,
    ur.role
FROM auth.users u
LEFT JOIN public.profiles p ON u.id = p.id
LEFT JOIN public.user_roles ur ON u.id = ur.user_id
WHERE u.id = '84401dfc-f23e-46e7-b201-868f2140ab73';

──────────────────────────────────────────────────────────────────

3. Cliquez sur "RUN"

4. Vérifiez le résultat :
   ✅ Vous DEVEZ voir :
      - téléphone: +33661002616
      - téléphone_confirmé: (une date)
      - full_name: Super Administrateur
      - role: super_admin

═══════════════════════════════════════════════════════════════════
  🧪 TEST IMMÉDIAT APRÈS LE SCRIPT
═══════════════════════════════════════════════════════════════════

1. Allez sur : /auth/super-admin

2. Entrez le PIN : 999999

3. Cliquez : "Se connecter"

4. ✅ SUCCÈS : Redirection vers /dashboard/super-admin

═══════════════════════════════════════════════════════════════════
  📊 LOGS ATTENDUS (Console F12)
═══════════════════════════════════════════════════════════════════

Vous devriez maintenant voir :

🔐 Démarrage authentification Super Admin...
🔍 Vérification du PIN...
✅ PIN correct
🔍 Recherche du profil Super Admin...
   - Email: 33661002616@ndjobi.com
   - Téléphone: +33661002616
📊 Résultat recherche par email: { profileData: {...} }
✅ Profil trouvé: { id: "...", email: "...", phone: "+33661002616" }
🔍 Vérification du rôle...
✅ Rôle super_admin confirmé
🔧 Création de la session locale...
✅ Session Super Admin créée avec succès

═══════════════════════════════════════════════════════════════════
  💡 POURQUOI CE SCRIPT ?
═══════════════════════════════════════════════════════════════════

Le compte a été créé avec EMAIL uniquement.
Le téléphone n'était pas activé dans auth.users.

Ce script :
1. Active le téléphone dans auth.users
2. Confirme le téléphone (phone_confirmed_at)
3. Ajoute "phone" aux providers
4. Met à jour les métadonnées utilisateur
5. Vérifie le profil et le rôle

APRÈS CE SCRIPT, LE SYSTÈME SERA 100% FONCTIONNEL ! 🚀

