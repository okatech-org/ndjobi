# üìã PLAN D√âTAILL√â DE L'APPLICATION NDJOBI

## üéØ **VISION G√âN√âRALE**

**NDJOBI** est une plateforme web anti-corruption d√©velopp√©e pour le Gabon, permettant aux citoyens de d√©noncer anonymement la corruption et de prot√©ger leurs innovations avec un horodatage blockchain infalsifiable.

---

## üèóÔ∏è **ARCHITECTURE SYST√àME**

### **Stack Technologique**
- **Frontend** : React 18 + TypeScript + Vite
- **UI/UX** : Tailwind CSS + shadcn/ui
- **Backend** : Supabase (PostgreSQL + Auth + Storage)
- **Authentification** : Supabase Auth avec RLS (Row Level Security)
- **D√©ploiement** : Netlify (Frontend) + Supabase Cloud (Backend)

### **Structure des Dossiers**
```
src/
‚îú‚îÄ‚îÄ components/          # Composants r√©utilisables
‚îÇ   ‚îú‚îÄ‚îÄ ai-agent/       # Chatbot IA pour signalements
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/      # Composants sp√©cifiques aux dashboards
‚îÇ   ‚îî‚îÄ‚îÄ ui/             # Composants UI de base (shadcn/ui)
‚îú‚îÄ‚îÄ hooks/              # Hooks personnalis√©s React
‚îú‚îÄ‚îÄ integrations/       # Configuration Supabase
‚îú‚îÄ‚îÄ pages/              # Pages de l'application
‚îÇ   ‚îî‚îÄ‚îÄ dashboards/     # Dashboards par r√¥le
‚îú‚îÄ‚îÄ services/           # Services m√©tier
‚îú‚îÄ‚îÄ types/              # Types TypeScript
‚îî‚îÄ‚îÄ utils/              # Utilitaires
```

---

## üë• **SYST√àME DE R√îLES ET PERMISSIONS**

### **1. CITOYEN (user)**
**R√¥le de base** - Acc√®s public et authentifi√©

**Fonctionnalit√©s :**
- ‚úÖ Signalements anonymes via chatbot IA
- ‚úÖ Signalements identifi√©s avec compte
- ‚úÖ Protection de projets (copyright, marque, etc.)
- ‚úÖ Gestion de profil personnel
- ‚úÖ Consultation des statistiques publiques
- ‚úÖ Upload et gestion de fichiers

**Pages accessibles :**
- `/` - Page d'accueil
- `/report` - Signalement anonyme
- `/auth` - Authentification
- `/dashboard/user` - Dashboard personnel

### **2. AGENT DGSS (agent)**
**R√¥le d'investigation** - Traitement des signalements

**Fonctionnalit√©s :**
- ‚úÖ Consultation des signalements assign√©s
- ‚úÖ Gestion des enqu√™tes et investigations
- ‚úÖ Mise √† jour du statut des cas
- ‚úÖ Soumission de rapports d'enqu√™te
- ‚úÖ Upload de preuves et documents
- ‚úÖ Visualisation g√©ographique des cas
- ‚úÖ Statistiques personnelles de performance

**Pages accessibles :**
- `/dashboard/agent` - Dashboard agent avec 5 vues :
  - **Dashboard** : Vue d'ensemble et statistiques
  - **Signalements** : Liste des cas assign√©s
  - **Enqu√™tes** : Gestion des investigations
  - **Carte** : Visualisation g√©ographique
  - **Profil** : Informations personnelles

### **3. PROTOCOLE D'√âTAT (admin)**
**R√¥le de supervision** - Gestion des agents et validation

**Fonctionnalit√©s :**
- ‚úÖ Gestion des agents DGSS
- ‚úÖ Validation des cas et enqu√™tes
- ‚úÖ Supervision des performances
- ‚úÖ Rapports et statistiques avanc√©es
- ‚úÖ Gestion des autorisations
- ‚úÖ Monitoring du syst√®me

**Pages accessibles :**
- `/dashboard/admin` - Dashboard administrateur

### **4. SUPER ADMIN (super_admin)**
**R√¥le syst√®me** - Administration compl√®te

**Fonctionnalit√©s :**
- ‚úÖ Gestion compl√®te du syst√®me
- ‚úÖ Administration des utilisateurs
- ‚úÖ Configuration des r√¥les
- ‚úÖ Monitoring technique
- ‚úÖ Gestion des modules (XR-7, etc.)
- ‚úÖ Acc√®s √† toutes les donn√©es

**Pages accessibles :**
- `/dashboard/super-admin` - Dashboard super administrateur

---

## üóÑÔ∏è **ARCHITECTURE DE BASE DE DONN√âES**

### **Tables Principales**

#### **1. Authentification & Utilisateurs**
```sql
-- Profils utilisateurs (extension de auth.users)
profiles (
  id UUID PRIMARY KEY,
  email TEXT,
  full_name TEXT,
  avatar_url TEXT,
  organization TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- R√¥les utilisateurs
user_roles (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  role app_role, -- 'user', 'agent', 'admin', 'super_admin'
  created_at TIMESTAMP
)

-- Codes PIN pour s√©curit√©
user_pins (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  pin_hash TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)
```

#### **2. Signalements & Enqu√™tes**
```sql
-- Signalements de corruption
signalements (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id), -- NULL pour anonymes
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  type TEXT NOT NULL, -- 'incident', 'projet', etc.
  status TEXT DEFAULT 'pending', -- 'pending', 'investigation', 'resolved', 'closed'
  priority TEXT DEFAULT 'normal', -- 'low', 'normal', 'high', 'critique'
  location TEXT,
  attachments JSONB DEFAULT '[]',
  metadata JSONB DEFAULT '{}', -- Donn√©es anonymes, t√©moins, etc.
  is_anonymous BOOLEAN DEFAULT false,
  device_id TEXT, -- Pour tracking anonyme
  gps_latitude DECIMAL,
  gps_longitude DECIMAL,
  submission_method TEXT, -- 'web', 'mobile', 'api'
  assigned_agent_id UUID REFERENCES auth.users(id),
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  resolved_at TIMESTAMP,
  resolved_by UUID REFERENCES auth.users(id)
)

-- Enqu√™tes (√† cr√©er)
investigations (
  id UUID PRIMARY KEY,
  case_id UUID REFERENCES signalements(id),
  agent_id UUID REFERENCES auth.users(id),
  title TEXT,
  status TEXT DEFAULT 'pending', -- 'pending', 'active', 'completed'
  progress INTEGER DEFAULT 0,
  witnesses_count INTEGER DEFAULT 0,
  evidence_count INTEGER DEFAULT 0,
  next_step TEXT,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  completed_at TIMESTAMP
)

-- Rapports d'enqu√™te (√† cr√©er)
investigation_reports (
  id UUID PRIMARY KEY,
  case_id UUID REFERENCES signalements(id),
  agent_id UUID REFERENCES auth.users(id),
  type TEXT, -- 'progress', 'witness', 'evidence', 'final'
  description TEXT,
  attachments JSONB DEFAULT '[]',
  created_at TIMESTAMP
)
```

#### **3. Protection de Projets**
```sql
-- Projets prot√©g√©s
projets (
  id UUID PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id), -- NULL pour anonymes
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  category TEXT NOT NULL, -- 'artistique', 'litteraire', 'logiciel', 'marque'
  status TEXT DEFAULT 'draft', -- 'draft', 'submitted', 'protected', 'rejected'
  protection_type TEXT, -- 'copyright', 'trademark', 'patent'
  files JSONB DEFAULT '[]',
  metadata JSONB DEFAULT '{}',
  device_id TEXT, -- Pour tracking anonyme
  is_anonymous BOOLEAN DEFAULT false,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  protected_at TIMESTAMP,
  protection_number TEXT UNIQUE
)
```

#### **4. Syst√®me d'Identit√© d'Appareil**
```sql
-- Sessions d'appareils
device_sessions (
  id UUID PRIMARY KEY,
  device_id TEXT UNIQUE,
  fingerprint_data JSONB,
  user_id UUID REFERENCES auth.users(id), -- NULL si anonyme
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  last_activity TIMESTAMP
)

-- Signalements par appareil
device_signalements (
  id UUID PRIMARY KEY,
  device_id TEXT,
  signalement_id UUID REFERENCES signalements(id),
  created_at TIMESTAMP
)

-- Projets par appareil
device_projets (
  id UUID PRIMARY KEY,
  device_id TEXT,
  projet_id UUID REFERENCES projets(id),
  created_at TIMESTAMP
)
```

#### **5. Module d'Urgence (XR-7)**
```sql
-- Autorisations judiciaires
judicial_authorizations (
  authorization_number TEXT PRIMARY KEY,
  issued_by TEXT,
  issued_date DATE,
  expiry_date DATE,
  scope TEXT,
  conditions JSONB
)

-- Activations d'urgence
emergency_activations (
  id UUID PRIMARY KEY,
  activated_by UUID REFERENCES auth.users(id),
  judicial_authorization TEXT REFERENCES judicial_authorizations(authorization_number),
  reason TEXT,
  legal_reference TEXT,
  start_date TIMESTAMP,
  end_date TIMESTAMP,
  duration_hours INTEGER,
  status TEXT,
  biometric_validated BOOLEAN,
  two_factor_validated BOOLEAN,
  activation_metadata JSONB,
  created_at TIMESTAMP,
  updated_at TIMESTAMP,
  deactivated_at TIMESTAMP,
  deactivation_reason TEXT
)

-- Enregistrements audio d'urgence
emergency_audio_recordings (
  id UUID PRIMARY KEY,
  activation_id UUID REFERENCES emergency_activations(id),
  file_path TEXT,
  duration_seconds INTEGER,
  created_at TIMESTAMP
)
```

---

## üõ£Ô∏è **ARCHITECTURE DE NAVIGATION**

### **Routes Publiques**
```
/                    # Page d'accueil (non connect√©)
/auth               # Authentification
/report             # Signalement anonyme
/statistiques       # Statistiques publiques
```

### **Routes Prot√©g√©es**
```
/dashboard                    # Redirection selon le r√¥le
‚îú‚îÄ‚îÄ /dashboard/user          # Dashboard citoyen
‚îú‚îÄ‚îÄ /dashboard/agent         # Dashboard agent DGSS
‚îú‚îÄ‚îÄ /dashboard/admin         # Dashboard protocole d'√©tat
‚îî‚îÄ‚îÄ /dashboard/super-admin   # Dashboard super admin
```

### **Syst√®me de Redirection**
1. **Utilisateur non connect√©** ‚Üí `/auth`
2. **Utilisateur connect√© sans r√¥le** ‚Üí `/dashboard/user`
3. **Redirection automatique** selon le r√¥le via `/dashboard`

---

## üé® **INTERFACES UTILISATEUR**

### **1. Page d'Accueil (`/`)**
**Composants :**
- `Header` - Navigation principale
- `HeroSection` - Pr√©sentation de la plateforme
- `CTACards` - Actions principales (Taper le Ndjobi, Prot√©ger)
- `TrustSection` - √âl√©ments de confiance
- `StatsSection` - Statistiques publiques
- `Footer` - Informations l√©gales

**Fonctionnalit√©s :**
- Navigation vers signalement anonyme
- Redirection vers protection de projet
- Affichage des statistiques publiques
- Redirection automatique si connect√©

### **2. Page de Signalement (`/report`)**
**Composants :**
- `NdjobiAIAgent` - Chatbot IA pour signalements
- `ReportFormStepper` - Formulaire manuel multi-√©tapes

**Fonctionnalit√©s :**
- Signalement via chatbot conversationnel
- Formulaire manuel avec g√©olocalisation
- Upload de fichiers et preuves
- Choix anonyme/identifi√©
- Validation et soumission

### **3. Dashboard Citoyen (`/dashboard/user`)**
**Vues disponibles :**
- **Profil** - Informations personnelles
- **Signalement** - Nouveau signalement
- **Protection** - Protection de projet
- **Dossiers** - Fichiers et documents
- **Param√®tres** - Configuration

**Fonctionnalit√©s :**
- Gestion de profil avec avatar
- Cr√©ation de signalements identifi√©s
- Protection de projets (copyright, marque)
- Upload et gestion de fichiers
- Configuration des pr√©f√©rences

### **4. Dashboard Agent (`/dashboard/agent`)**
**Vues disponibles :**
- **Dashboard** - Vue d'ensemble et statistiques
- **Signalements** - Cas assign√©s avec filtres
- **Enqu√™tes** - Gestion des investigations
- **Carte** - Visualisation g√©ographique
- **Profil** - Informations et performance

**Fonctionnalit√©s :**
- Statistiques personnelles en temps r√©el
- Filtrage et recherche de cas
- Actions sur les signalements (voir, enqu√™ter, r√©soudre)
- Gestion des enqu√™tes (actives, en attente, termin√©es)
- Soumission de rapports d'enqu√™te
- Upload de preuves et documents
- Visualisation g√©ographique des interventions

### **5. Dashboard Admin (`/dashboard/admin`)**
**Fonctionnalit√©s :**
- Gestion des agents DGSS
- Validation des cas et enqu√™tes
- Supervision des performances
- Rapports et statistiques avanc√©es
- Gestion des autorisations

### **6. Dashboard Super Admin (`/dashboard/super-admin`)**
**Fonctionnalit√©s :**
- Gestion compl√®te du syst√®me
- Administration des utilisateurs
- Configuration des r√¥les
- Monitoring technique
- Gestion des modules (XR-7, etc.)

---

## üîê **S√âCURIT√â ET AUTHENTIFICATION**

### **Syst√®me d'Authentification**
- **Supabase Auth** avec JWT
- **Row Level Security (RLS)** sur toutes les tables
- **Politiques de s√©curit√©** par r√¥le
- **Codes PIN** pour s√©curit√© suppl√©mentaire

### **Gestion des R√¥les**
```typescript
type UserRole = 'user' | 'agent' | 'admin' | 'super_admin';

// Hi√©rarchie des permissions
super_admin > admin > agent > user
```

### **Politiques de S√©curit√©**
- **Utilisateurs** : Acc√®s √† leurs propres donn√©es
- **Agents** : Acc√®s aux signalements assign√©s
- **Admins** : Acc√®s √† tous les signalements et agents
- **Super Admins** : Acc√®s complet au syst√®me

### **Signalements Anonymes**
- **Device ID** pour tracking sans identification
- **Fingerprinting** pour √©viter les doublons
- **Migration automatique** vers compte utilisateur
- **G√©olocalisation** optionnelle

---

## ü§ñ **INTELLIGENCE ARTIFICIELLE**

### **Chatbot Ndjobi (`NdjobiAIAgent`)**
**Fonctionnalit√©s :**
- Conversation naturelle pour signalements
- Collecte d'informations structur√©es
- Validation des donn√©es
- G√©olocalisation automatique
- Upload de fichiers via chat
- Choix anonyme/identifi√©

**Flux de conversation :**
1. **Accueil** - Pr√©sentation et consentement
2. **Type de signalement** - Classification
3. **D√©tails** - Description d√©taill√©e
4. **Localisation** - Lieu et g√©olocalisation
5. **Preuves** - Upload de fichiers
6. **Anonymat** - Choix d'identification
7. **Validation** - R√©capitulatif et soumission

---

## üìä **SYST√àME DE STATISTIQUES**

### **Statistiques Publiques**
- Nombre total de signalements
- Taux de r√©solution
- R√©partition g√©ographique
- Types de corruption les plus fr√©quents

### **Statistiques Agents**
- Cas assign√©s et r√©solus
- Taux de r√©ussite personnel
- Temps moyen de traitement
- Objectifs mensuels

### **Statistiques Administrateurs**
- Performance des agents
- Tendance des signalements
- Analyse g√©ographique
- Rapports de performance

---

## üó∫Ô∏è **SYST√àME DE G√âOLOCALISATION**

### **Fonctionnalit√©s**
- **G√©olocalisation automatique** via API navigator
- **S√©lection manuelle** sur carte interactive
- **Validation des coordonn√©es** GPS
- **Visualisation g√©ographique** des cas
- **Statistiques par r√©gion**

### **Int√©gration**
- **Signalements** : Localisation obligatoire
- **Dashboard Agent** : Carte des interventions
- **Statistiques** : R√©partition g√©ographique

---

## üìÅ **GESTION DE FICHIERS**

### **Types de Fichiers Support√©s**
- **Images** : JPG, PNG, GIF, WebP
- **Documents** : PDF, DOC, DOCX, TXT
- **Audio** : MP3, WAV, M4A
- **Vid√©o** : MP4, AVI, MOV

### **Stockage**
- **Supabase Storage** avec buckets s√©par√©s
- **Compression automatique** des images
- **Scan antivirus** (√† impl√©menter)
- **Chiffrement** des fichiers sensibles

### **Organisation**
```
storage/
‚îú‚îÄ‚îÄ signalements/     # Fichiers de signalements
‚îú‚îÄ‚îÄ projets/         # Fichiers de projets prot√©g√©s
‚îú‚îÄ‚îÄ investigations/  # Preuves d'enqu√™tes
‚îî‚îÄ‚îÄ profiles/        # Avatars utilisateurs
```

---

## üîÑ **FLUX DE TRAVAIL**

### **Signalement de Corruption**
1. **Cr√©ation** - Via chatbot ou formulaire
2. **Validation** - V√©rification des donn√©es
3. **Assignation** - Attribution √† un agent
4. **Investigation** - Enqu√™te par l'agent
5. **Rapport** - Soumission du rapport
6. **R√©solution** - Cl√¥ture du cas

### **Protection de Projet**
1. **D√©claration** - Cr√©ation du projet
2. **Upload** - Ajout des fichiers
3. **Validation** - V√©rification technique
4. **Horodatage** - Blockchain timestamp
5. **Protection** - G√©n√©ration du certificat

### **Gestion des Enqu√™tes**
1. **Assignation** - Attribution √† un agent
2. **Planification** - D√©finition des √©tapes
3. **Investigation** - Collecte de preuves
4. **Rapports** - Documentation des progr√®s
5. **Cl√¥ture** - Finalisation de l'enqu√™te

---

## üöÄ **D√âPLOIEMENT ET MAINTENANCE**

### **Environnements**
- **D√©veloppement** : Local avec Supabase local
- **Staging** : Netlify Preview + Supabase Cloud
- **Production** : Netlify + Supabase Cloud

### **CI/CD**
- **GitHub Actions** pour tests automatiques
- **D√©ploiement automatique** sur push main
- **Tests de r√©gression** avant d√©ploiement
- **Monitoring** des performances

### **Monitoring**
- **Supabase Dashboard** pour la base de donn√©es
- **Netlify Analytics** pour les performances
- **Sentry** pour le monitoring d'erreurs
- **Logs** centralis√©s

---

## üìà **ROADMAP FUTURE**

### **Phase 1 - Actuelle** ‚úÖ
- ‚úÖ Syst√®me de signalements anonymes
- ‚úÖ Protection de projets
- ‚úÖ Dashboard agent fonctionnel
- ‚úÖ Authentification et r√¥les

### **Phase 2 - Court terme**
- üîÑ Module d'urgence XR-7 complet
- üîÑ Notifications push
- üîÑ API mobile
- üîÑ Syst√®me de r√©compenses

### **Phase 3 - Moyen terme**
- üìã Int√©gration blockchain compl√®te
- üìã IA avanc√©e pour analyse
- üìã Tableau de bord analytics
- üìã Int√©gration avec services gouvernementaux

### **Phase 4 - Long terme**
- üìã Application mobile native
- üìã Syst√®me de r√©putation
- üìã Int√©gration internationale
- üìã Plateforme multi-pays

---

## üõ†Ô∏è **OUTILS DE D√âVELOPPEMENT**

### **Scripts Disponibles**
```bash
# D√©veloppement
bun run dev          # Serveur de d√©veloppement
bun run build        # Build de production
bun run preview      # Preview du build

# Base de donn√©es
supabase start       # D√©marrer Supabase local
supabase db reset    # Reset de la base
supabase gen types   # G√©n√©rer les types TypeScript

# Tests
bun run test         # Tests unitaires
bun run lint         # Linting
bun run type-check   # V√©rification TypeScript
```

### **Structure de D√©veloppement**
- **Hot Reload** avec Vite
- **TypeScript strict** pour la s√©curit√©
- **ESLint + Prettier** pour la qualit√©
- **Husky** pour les hooks Git
- **Conventional Commits** pour l'historique

---

## üìû **SUPPORT ET MAINTENANCE**

### **Documentation**
- **README.md** - Guide d'installation
- **PLAN-DETAILLE-NDJOBI.md** - Ce document
- **API.md** - Documentation API
- **DEPLOYMENT.md** - Guide de d√©ploiement

### **Contact**
- **D√©veloppement** : okatech-org/ndjobi
- **Support** : Via issues GitHub
- **Documentation** : Wiki du projet

---

*Ce plan d√©taill√© couvre l'ensemble de l'architecture, des fonctionnalit√©s et du fonctionnement de la plateforme NDJOBI. Il sert de r√©f√©rence pour le d√©veloppement, la maintenance et l'√©volution du syst√®me.*
