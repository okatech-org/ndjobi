╔═══════════════════════════════════════════════════════════╗
║                                                           ║
║     🎯 GUIDE COMPLET - CRÉATION COMPTE SUPER ADMIN       ║
║                                                           ║
╚═══════════════════════════════════════════════════════════╝


📋 INFORMATIONS DU COMPTE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📧 Email : superadmin@ndjobi.com
📱 Numéro : +33661002616
📧 Email contact (OTP) : iasted@me.com
🔐 PIN : 999999 (6 chiffres)


🚀 ÉTAPE 1 : CRÉER LE COMPTE DANS SUPABASE AUTH
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Ouvrir Supabase Auth Users :
   👉 https://supabase.com/dashboard/project/xfxqwlbqysiezqdpeqpv/auth/users

2. Cliquer sur "Add user" (bouton en haut à droite)

3. Remplir le formulaire :
   ┌─────────────────────────────────────────────┐
   │ Email : superadmin@ndjobi.com               │
   │ Password : 999999                           │
   │ ✅ Auto Confirm User (COCHER OBLIGATOIRE)   │
   └─────────────────────────────────────────────┘

4. Cliquer "Create user"

5. ✅ Le compte est créé dans auth.users !


🗄️ ÉTAPE 2 : CONFIGURER LE PROFIL ET LES RÔLES
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Ouvrir SQL Editor :
   👉 https://supabase.com/dashboard/project/xfxqwlbqysiezqdpeqpv/sql

2. Copier et coller ce script SQL :

BEGIN;

DO $$
DECLARE
    v_user_id uuid;
BEGIN
    -- Récupérer l'ID de l'utilisateur créé
    SELECT id INTO v_user_id
    FROM auth.users
    WHERE email = 'superadmin@ndjobi.com';
    
    IF NOT FOUND THEN
        RAISE EXCEPTION '❌ Utilisateur superadmin@ndjobi.com non trouvé. Créez-le d''abord via Auth > Users.';
    END IF;
    
    -- Créer le profil
    INSERT INTO public.profiles (id, email, full_name, phone, created_at, updated_at)
    VALUES (
        v_user_id,
        'superadmin@ndjobi.com',
        'Super Administrateur',
        '+33661002616',
        NOW(),
        NOW()
    )
    ON CONFLICT (id) DO UPDATE SET
        email = EXCLUDED.email,
        full_name = EXCLUDED.full_name,
        phone = EXCLUDED.phone,
        updated_at = NOW();
    
    -- Attribuer le rôle super_admin
    INSERT INTO public.user_roles (user_id, role)
    VALUES (v_user_id, 'super_admin')
    ON CONFLICT (user_id) DO UPDATE SET
        role = 'super_admin';
    
    RAISE NOTICE '';
    RAISE NOTICE '═══════════════════════════════════════════════════════';
    RAISE NOTICE '  ✅ COMPTE SUPER ADMIN CRÉÉ AVEC SUCCÈS !';
    RAISE NOTICE '═══════════════════════════════════════════════════════';
    RAISE NOTICE '';
    RAISE NOTICE '📧 Email : superadmin@ndjobi.com';
    RAISE NOTICE '📱 Numéro : +33661002616';
    RAISE NOTICE '📧 Email contact : iasted@me.com';
    RAISE NOTICE '🔐 PIN : 999999';
    RAISE NOTICE '';
    RAISE NOTICE '💡 Connexion :';
    RAISE NOTICE '   1. Double-clic sur 🛡️';
    RAISE NOTICE '   2. Numéro : +33661002616';
    RAISE NOTICE '   3. PIN : 999999';
    RAISE NOTICE '';
    RAISE NOTICE '═══════════════════════════════════════════════════════';
    
END $$;

COMMIT;

-- Vérification
SELECT 
    '✅ VÉRIFICATION' as statut,
    u.id,
    u.email,
    u.email_confirmed_at,
    p.full_name,
    p.phone,
    ur.role
FROM auth.users u
LEFT JOIN public.profiles p ON p.id = u.id
LEFT JOIN public.user_roles ur ON ur.user_id = u.id
WHERE u.email = 'superadmin@ndjobi.com';

3. Cliquer "RUN"

4. Vérifier les messages :
   ✅ Compte Super Admin créé avec succès !
   ✅ Profil créé
   ✅ Rôle super_admin attribué


🔄 ÉTAPE 3 : REDÉMARRER LE SERVEUR
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Dans le terminal :
npm run dev


🧪 ÉTAPE 4 : TESTER LA CONNEXION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Ouvrir : http://localhost:5173/auth

2. Double-clic sur l'icône 🛡️ (Shield)

3. Remplir le formulaire :
   - Numéro : +33661002616
   - PIN : 999999

4. Cliquer "Se connecter"

5. ✅ Connexion réussie !


📊 CONSOLE - LOGS ATTENDUS
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Après connexion :
✅ "Authentification Super Admin (compte réel Supabase)"
✅ "Tentative de connexion Supabase: superadmin@ndjobi.com"
✅ "Authentification Supabase réussie"
✅ "Rôle super_admin confirmé"
✅ "Session Super Admin sauvegardée dans localStorage"
✅ "Session Super Admin créée avec succès"

Après refresh (F5) :
✅ "Restauration session Super Admin"
✅ "SuperAdminDashboard: Session locale trouvée"


🧪 TESTS DE PERSISTANCE
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Actualiser la page (F5) → ✅ Toujours connecté
2. Actualiser 10 fois → ✅ Toujours connecté
3. Fermer l'onglet → Rouvrir → ✅ Toujours connecté
4. Vérifier localStorage (DevTools F12) :
   → Local Storage → ndjobi_super_admin_session
   → Voir : { user: {...}, role: "super_admin" }


🔧 TEST DE DÉCONNEXION
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Cliquer sur le bouton "Déconnexion"
2. ✅ Redirection vers /auth
3. ✅ localStorage vidé
4. F5 → ✅ Reste déconnecté


🔴 TEST "PIN OUBLIÉ"
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. Double-clic sur 🛡️
2. Cliquer "PIN oublié ?"
3. Numéro : +33661002616
4. Choisir le canal : SMS / WhatsApp / Email
5. Recevoir le code OTP
6. Vérifier le code
7. Créer un nouveau PIN
8. ✅ Connexion avec le nouveau PIN


🎯 CARACTÉRISTIQUES DU SYSTÈME
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✨ VRAI compte Supabase (pas demo)
✨ Authentification via Supabase Auth
✨ Session Supabase complète (tokens, refresh)
✨ Persistance localStorage pour UX optimale
✨ Support de la réinitialisation de PIN
✨ Interface discrète (double-clic 🛡️)
✨ Même système que les autres utilisateurs
✨ Production-ready


━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎉 Votre compte Super Admin est maintenant un VRAI compte professionnel !

⏱️  Temps total : ~5 minutes
🎯 Difficulté : Facile

